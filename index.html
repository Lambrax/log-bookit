<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IT Operations LogBook</title>
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
    
    <style>
        /* === GAYA TAMPILAN (CSS) === */
        :root { --primary-color: #d4a017; --bg-color: #f4f6f9; }
        body { background-color: var(--bg-color); font-family: 'Segoe UI', sans-serif; overflow-x: hidden; }
        
        /* 1. LAYAR LOADING & LOGIN */
        #login-screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: white; z-index: 9999;
            display: flex; justify-content: center; align-items: center; flex-direction: column;
        }
        .spinner { width: 40px; height: 40px; border: 4px solid #eee; border-top: 4px solid var(--primary-color); border-radius: 50%; animation: spin 1s linear infinite; margin-bottom: 20px;}
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        
        #forbidden-msg { color: #dc3545; display: none; text-align: center; margin-top: 20px; }

        /* 2. DASHBOARD (Awalnya Sembunyi) */
        #main-app { display: none; } /* KITA SEMBUNYIKAN DULU */
        
        /* ... (Masukkan CSS Sidebar, Card, Table LogBook Anda disini) ... */
        /* Agar tidak kepanjangan, saya persingkat CSS layout utamanya */
        .sidebar { width: 250px; height: 100vh; position: fixed; background: white; border-right: 1px solid #eee; padding: 20px; }
        .content { margin-left: 250px; padding: 30px; }
        @media (max-width: 768px) { .sidebar { display: none; } .content { margin-left: 0; } }
    </style>
</head>
<body>

    <div id="login-screen">
        <div class="spinner" id="loader"></div>
        <h4 id="status-text">Checking Access...</h4>
        <div id="forbidden-msg">
            <h1>ðŸš« Access Denied</h1>
            <p>You are not authorized to view this page.<br>Please use your Company Google Account.</p>
            <a href="https://accounts.google.com/Logout" class="btn btn-outline-danger btn-sm mt-3">Logout & Switch Account</a>
        </div>
        
        <button id="btn-login-trigger" class="btn btn-warning text-white fw-bold mt-3" style="display:none;" onclick="triggerLogin()">
            <i class="bi bi-google"></i> Login with Google
        </button>
    </div>

    <div id="main-app">
        <div class="sidebar">
            <h3>IT LogBook</h3>
            <div id="user-info">Loading User...</div>
            <hr>
            <button class="btn btn-primary w-100">Dashboard</button>
        </div>

        <div class="content">
            <h2>Welcome, <span id="display-name">User</span>!</h2>
            <p>This is your secure dashboard.</p>
            <div class="alert alert-success">âœ… Data Loaded from Google Script</div>
        </div>
    </div>

    <script>
        // --- GANTI URL INI DENGAN DEPLOYMENT BARU ANDA ---
        const SCRIPT_URL = "https://script.google.com/a/macros/go-work.com/s/AKfycbxWEFNa6Arg1B3ec4B8A7UEjn06jGWYfSSw9dGKkHXdKXzEHXhnZglCHKoHGhZJGBhm/exec";

        // 1. Cek Status Login saat Web Dibuka
        window.onload = function() {
            checkAccess();
        };

        function checkAccess() {
            // Kita pakai teknik JSONP atau Fetch (dengan mode no-cors jika perlu, tapi JSONP lebih stabil untuk Google Script API sederhana)
            // Namun karena CORS Google Script agak ketat, cara paling ampuh "seolah-olah login" adalah fetch biasa.
            
            fetch(SCRIPT_URL)
            .then(response => response.json())
            .then(data => {
                if (data.status === "success") {
                    // BERHASIL: Buka Dashboard
                    document.getElementById('login-screen').style.display = 'none';
                    document.getElementById('main-app').style.display = 'block';
                    
                    document.getElementById('display-name').innerText = data.user;
                    document.getElementById('user-info').innerText = data.user;
                } else {
                    // DITOLAK: Tampilkan Forbidden
                    showForbidden();
                }
            })
            .catch(error => {
                // ERROR (Biasanya karena belum login browser sama sekali)
                console.error("Login Error:", error);
                document.getElementById('loader').style.display = 'none';
                document.getElementById('status-text').innerText = "Please Login first";
                document.getElementById('btn-login-trigger').style.display = 'block';
            });
        }

        function showForbidden() {
            document.getElementById('loader').style.display = 'none';
            document.getElementById('status-text').style.display = 'none';
            document.getElementById('forbidden-msg').style.display = 'block';
        }

        function triggerLogin() {
            // Trik: Buka tab baru ke Google Script untuk memancing Login Cookie, lalu balik lagi
            window.open(SCRIPT_URL, '_blank');
        }
    </script>
</body>
</html>
